function CermaiJs(){this.app=app,this.run=function(){void 0==config.app.host?app.listen(config.app.port,function(){console.log("Application Running On *:"+config.app.port)}):app.listen(config.app.port,config.app.host,function(){console.log("Application Running On "+config.app.host+":"+config.app.port)})},this.connect=function(a){if(void 0==config.connection)a("connection null",null);else if(null!=config.connection.replica){var b=config.connection.host+":"+config.connection.port;config.connection.members.forEach(function(a){b+=","+a.host+":"+a.port}),""==config.connection.user&&""==config.connection.pwd?mongoDB.connect("mongodb://"+b+"/"+config.connection.db,function(b,c){a(b,c)}):mongoDB.connect("mongodb://"+config.connection.user+":"+config.connection.pwd+"@"+b+"/"+config.connection.db,function(b,c){a(b,c)})}else""!=config.connection.user&&void 0!=config.connection.user||""!=config.connection.pwd&&void 0!=config.connection.pwd?mongoDB.connect("mongodb://"+config.connection.user+":"+config.connection.pwd+"@"+config.connection.host+":"+config.connection.port+"/"+config.connection.db,function(b,c){a(b,c)}):mongoDB.connect("mongodb://"+config.connection.host+":"+config.connection.port+"/"+config.connection.db,function(b,c){a(b,c)})},this.initCermai=function(a,b){null==b&&console.log("CERMAI RUNNNIG WITHOUT CONNECTION"),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),a.set("views",path.join(__dirname,"/views")),a.set("view engine","jade"),a.use(require("stylus").middleware(path.join(__dirname,"public"))),a.use(express["static"](path.join(__dirname,"/public"))),routes(a,b),a.use((new ErrorHandler).error404),a.use((new ErrorHandler).error500)},this.initHelper=function(a){a.use(helper)},this.initSession=function(a){var b=require("express-session"),c=require("connect-redis")(b),d=require("cookie-parser"),e="cermaisession";if(config.session&&(e=config.session.secret||"cermaisession"),a.use(d(e)),null!=config.redis){var f=require("redis").createClient();a.use(b({secret:e,store:new c({host:config.redis.host.toString(),port:config.redis.port,client:f,db:config.redis.db,pass:config.redis.pwd.toString()}),resave:!0}))}else a.use(b({secret:e,store:"",resave:!0}));a.use(userSession)},this.isAuth=function(a,b,c){a.session.cermaiSession?c():b.redirect(config.page.login)}}var express=require("express"),app=express(),mode=process.env.NODE_ENV||"development",config=require("../config/config.json")[mode]||require("../config/config.json").development,mongoDB=require("mongodb").MongoClient,path=require("path"),helper=require("./helper"),userSession=require("./session"),routes=require("../routes"),ErrorHandler=require("./error"),bodyParser=require("body-parser");module.exports=CermaiJs;